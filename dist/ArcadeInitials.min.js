const w=window,d=w.document,values=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z",0,1,2,3,4,5,6,7,8,9];let uid=0;class InitialInput{constructor(t){this.uid=`aii_${++uid}`,this.total=values.length,this.current=t.current||0,this.parent=t.parent,this.el=this._render(),this.input=this.el.getElementsByTagName("div")[0],this.buttons=Array.prototype.slice.call(this.el.getElementsByTagName("button")),this.active=!1,this.onActiveChange=t.onActiveChange,this.startY=this.touchLastY=0,this.startThrottleTimer=this.throttleTimer=0,this.preventOnTouchEnd=!1,this.boundEvents=[],this._bind("touchstart",this._startHandler),this._bind("touchmove",this._moveHandler),this._bind("touchend",this._endHandler),t.active&&this.setActive()}getValue(){return values[this.current]}setActive(t=!0){return this.active=t,this.el.classList[t?"add":"remove"]("aii-active"),this._toggleButtons(t),"function"==typeof this.onActiveChange&&this.onActiveChange(this),this}increment(){return this.current=++this.current>this.total-1?0:this.current,this.setCurrent()}decrement(){return this.current=--this.current<0?this.total-1:this.current,this.setCurrent()}setCurrent(){return this.input.textContent=values[this.current],this}_render(){let t=d.createElement("div"),e='style="display:none;"';return t.classList.add("aii-box"),t.innerHTML=`<button data-dir="+" ${e}></button><div>${values[0]}</div><button data-dir="-" ${e}></button>`,this.parent.appendChild(t)}_toggleButtons(t=!0){this.buttons.forEach(e=>{e.style.display=t?"block":"none"})}_startHandler(t){if(t.preventDefault(),!this.active)return this.setActive();this.preventOnTouchEnd=!1,this.startY=Math.round(t.touches[0].pageY),this.active&&(this.startThrottleTimer=w.setTimeout(()=>this._holdHandler(),1e3))}_endHandler(t){let e=t.target;if(this._clearHoldTimers(),"button"===e.tagName.toLowerCase()&&(t.preventDefault(),!this.preventOnTouchEnd))return"+"===e.getAttribute("data-dir")?this.increment():void this.decrement()}_moveHandler(t){if(t.preventDefault(),this._clearHoldTimers(),"button"!==t.target.tagName.toLowerCase())return;this.preventOnTouchEnd=!0;let e=Math.round(t.touches[0].pageY),i=this.startY-e;i%10==0&&e!==this.touchLastY&&(i<0?this.increment():this.decrement()),this.touchLastY=e}_holdHandler(){this.preventOnTouchEnd=!0,this.throttleTimer=w.setInterval(()=>this.increment(),200)}_clearHoldTimers(){w.clearInterval(this.throttleTimer),w.clearTimeout(this.startThrottleTimer),this.startThrottleTimer=this.throttleTimer=0}_bind(t,e){this.el.addEventListener(t,e=e.bind(this),!1),this.boundEvents.push({type:t,fn:e})}_unbind(){this.boundEvents.forEach(t=>this.el.removeEventListener(t.type,t.fn,!1))}destroy(){this._clearHoldTimers(),this._unbind(),this.parent.removeChild(this.el),this.el=this.parent=this.input=this.buttons=null}}class InitialsFactory{constructor(){this.inputs=[],this.submitButton=this.submitHandler=null}create(t,e){for(;t;)this.inputs.push(new InitialInput({parent:e,onActiveChange:this._onActiveChange.bind(this)})),t--;return this}_onActiveChange(t){t.active&&this.inputs.forEach(e=>{e.uid!==t.uid&&e.setActive(!1)})}setActive(t){return this.inputs[t].setActive(),this}getInput(){let t="";return this.inputs.forEach(e=>t+=e.getValue()),t}bindSubmit(t,e){return this.submitButton=t,this.submitHandler=e.bind(this),t.addEventListener("click",this.submitHandler,!1),this}destroy(){return this.submitButton.removeEventListener("click",this.submitHandler,!1),this.inputs.forEach(t=>t.destroy()),this.inputs=this.submitButton=this.submitHandler=null,this}}export default InitialsFactory;
